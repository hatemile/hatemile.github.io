(function(){var b,a;a=this;this.hatemile||(this.hatemile={});(b=this.hatemile).implementation||(b.implementation={});this.hatemile.implementation.AccessibleEventImplementation=(function(){var x,v,m,q,c,j,s,g,d,w,l,t,f,i,r,k,h,o,n,u,e;q="data-ignoreaccessibilityfix";j="data-keypressed";c="data-keydownadded";s="data-keypressadded";g="data-keyupadded";m="data-focusadded";v="data-bluradded";x="click";l="hover";d="drag";w="drop";u=function(z){var A,y;A="\n".charCodeAt(0);y="\r".charCodeAt(0);return(z===A)||(z===y)};e=function(z){var y;if(!z.hasAttribute("tabindex")){y=z.getTagName();if((y==="A")&&(!z.hasAttribute("href"))){z.setAttribute("tabindex","0")}else{if((y!=="A")&&(y!=="INPUT")&&(y!=="BUTTON")&&(y!=="SELECT")&&(y!=="TEXTAREA")){z.setAttribute("tabindex","0")}}}};n=function(A,C,z,y){var B,D;D=A.getData();if((z===void 0)||(y===void 0)){return(D["on"+C] instanceof Function)||((D.eventListenerList!==void 0)&&(D.eventListenerList[C] instanceof Function))}else{B=A.getAttribute(z);return(n(A,C)&&(!A.hasAttribute(z)))||a.hatemile.util.CommonFunctions.inList(B,y)}};t=function(F){var C,E,D,z,B,A,y;z=F.find("[aria-dropeffect]").listResults();for(A=0,y=z.length;A<y;A++){D=z[A];E=(!n(D,"keydown",c,d))&&(!n(D,"keyup",g,d));C=(!D.hasAttribute(s))&&(!n(D,"keydown",c,x))&&(!n(D,"keyup",g,x));B=(!n(D,"focus",m,l))&&(!n(D,"blur",v,l));D.setAttribute("aria-dropeffect","none");if(D.hasAttribute("tabindex")&&E&&C&&B){D.removeAttribute("tabindex")}}};o=function(F){var B,D,C,z,E,A,y;D=a.__dragEventDataTransfer__.dropEffect;E=a.__dragEventDataTransfer__.effectAllowed;if((D==="none")||((D!=="copy")&&(D!=="link")&&(D!=="move"))){if((E==="copyLink")||(E==="copyMove")||(E==="linkMove")||(E==="all")){B="popup"}else{if((E==="copy")||(E==="move")||(E==="link")){B=E}else{B="move"}}}else{B=D}z=F.find("[aria-dropeffect]").listResults();for(A=0,y=z.length;A<y;A++){C=z[A];if(n(C,"drop")){C.setAttribute("aria-dropeffect",B)}e(C)}};h=function(z,y,A){k(y,i(z,y,A))};r=function(z,y,A){if(a.__dragEventDataTransfer__===void 0){a.__dragEventDataTransfer__={files:null,types:null,effectAllowed:"uninitialized",dropEffect:"none"};a.__dragEventDataTransfer__.setDragImage=function(){};a.__dragEventDataTransfer__.addElement=function(){};a.__dragEventDataTransfer__._data={};a.__dragEventDataTransfer__.setData=function(C,B){a.__dragEventDataTransfer__._data[C]=B};a.__dragEventDataTransfer__.getData=function(B){return a.__dragEventDataTransfer__._data[B]};a.__dragEventDataTransfer__.clearData=function(B){if(B===void 0){a.__dragEventDataTransfer__._data={}}else{a.__dragEventDataTransfer__._data[B]=void 0}}}k(y,f(z,y,A))};k=function(C,y){var H,G,F,B,D,E,I,z,A;z=C.getData();if(n(C,y.type)){B=z["on"+y.type];if(B instanceof Function){try{B.call(z,y)}catch(G){H=G}}if((z.eventListenerList!==void 0)&&(z.eventListenerList[y.type] instanceof Function)){A=z.eventListenerList[y.type];for(D=0,E=A.length;D<E;D++){I=A[D];try{I.call(z,y)}catch(F){H=F}}}}};i=function(z,y,A){var B;B={type:z,view:A.view,ctrlKey:A.ctrlKey,shiftKey:A.shiftKey,altKey:A.altKey,metaKey:A.metaKey,button:0,buttons:1,bubbles:true,cancelable:true,target:y.getData(),originalTarget:y.getData(),cancelBubble:false,isTrusted:true,detail:0,clientX:0,clientY:0,pageX:0,pageY:0,screenX:0,screenY:0,layerX:0,layerY:0,offsetX:0,offsetY:0};B.preventDefault=function(){return A.preventDefault()};B.stopImmediatePropagation=function(){return A.stopImmediatePropagation()};B.stopPropagation=function(){return A.stopPropagation()};return B};f=function(z,y,A){var B;B=i(z,y,A);B.dataTransfer=a.__dragEventDataTransfer__;return B};p.prototype._addEventHandler=function(B,D,A,z,y){var C,E,F;if(!n(B,D,A,z)){E=false;C=B.getAttribute(A);F=B.getData();if(!n(B,D)){F["liston"+D]=[];F["on"+D]=function(J){var K,H,G,I;I=F["liston"+D];for(H=0,G=I.length;H<G;H++){K=I[H];K(J)}}}else{E=a.hatemile.util.CommonFunctions.inList(C,z)}if(!E){F["liston"+D].push(y);C=a.hatemile.util.CommonFunctions.increaseInList(C,z);B.setAttribute(A,C)}}};p.prototype._visit=function(C,F,D,z){var E,B,A,y;if(!C.hasAttribute(q)){if(F(C)){z.call(D,C)}B=C.getChildrenElements();for(A=0,y=B.length;A<y;A++){E=B[A];this._visit(E,F,D,z)}}};function p(y){this.parser=y;this.cancelDragAdded=false}p.prototype.makeAccessibleDropEvents=function(y){var z;y.setAttribute("aria-dropeffect","none");z=this.parser;this._addEventHandler(y,"focus",m,w,function(A){if(z.find('[aria-grabbed="true"]').firstResult()!==null){r("dragenter",y,A);r("dragover",y,A);o(z)}});this._addEventHandler(y,"blur",v,w,function(A){if(z.find('[aria-grabbed="true"]').firstResult()!==null){r("dragleave",y,A);o(z)}});if((!n(y,"keydown",c,w))&&(!n(y,"keyup",g,w))){this._addEventHandler(y,"keydown",c,w,function(E){var B,C,D,A;if((u(E.keyCode))&&(!y.hasAttribute(j))&&(z.find("[aria-grabbed=true]").firstResult()!==null)){y.setAttribute(j,"true");if(n(y,"drop")){C=z.find('[aria-grabbed="true"]').listResults();for(D=0,A=C.length;D<A;D++){B=C[D];B.setAttribute("aria-grabbed","false");r("dragend",B,E)}t(z)}r("drop",y,E)}});this._addEventHandler(y,"keyup",g,w,function(A){y.removeAttribute(j)})}};p.prototype.makeAccessibleDragEvents=function(z){var A,y;e(z);z.setAttribute("aria-grabbed","false");A=this.parser;if((!n(z,"keydown",c,d))&&(!n(z,"keyup",g,d))){this._addEventHandler(z,"keydown",c,d,function(F){var C,D,E,B;if((F.keyCode===" ".charCodeAt(0))&&(!z.hasAttribute(j))){D=A.find('[aria-grabbed="true"]').listResults();for(E=0,B=D.length;E<B;E++){C=D[E];C.setAttribute("aria-grabbed","false");r("dragend",C,F)}z.setAttribute("aria-grabbed","true");z.setAttribute(j,"true");r("dragstart",z,F);r("drag",z,F);o(A)}});this._addEventHandler(z,"keyup",g,d,function(B){z.removeAttribute(j)})}if(!this.cancelDragAdded){y=this.parser.find("html").firstResult();this._addEventHandler(y,"keypress",s,x,function(F){var C,D,E,B;if(F.keyCode===27){D=A.find('[aria-grabbed="true"]').listResults();for(E=0,B=D.length;E<B;E++){C=D[E];C.setAttribute("aria-grabbed","false");r("dragend",C,F)}t(A)}});this.cancelDragAdded=true}};p.prototype.makeAccessibleAllDragandDropEvents=function(){var y;y=this.parser.find("body").firstResult();this._visit(y,function(z){return n(z,"drag")||n(z,"dragstart")||n(z,"dragend")},this,this.makeAccessibleDragEvents);this._visit(y,function(z){return n(z,"drop")||n(z,"dragenter")||n(z,"dragleave")||n(z,"dragover")},this,this.makeAccessibleDropEvents)};p.prototype.makeAccessibleHoverEvents=function(y){e(y);this._addEventHandler(y,"focus",m,l,function(z){h("mouseover",y,z)});this._addEventHandler(y,"blur",v,l,function(z){h("mouseout",y,z)})};p.prototype.makeAccessibleAllHoverEvents=function(){this._visit(this.parser.find("body").firstResult(),function(y){return n(y,"mouseover")||n(y,"mouseout")},this,this.makeAccessibleHoverEvents)};p.prototype.makeAccessibleClickEvents=function(z){var y,A;e(z);y=z.getTagName();A=["submit","button","reset"];if(((y!=="INPUT")||(!z.hasAttribute("type"))||(A.indexOf(z.getAttribute("type").toLowerCase())===-1))&&(y!=="BUTTON")&&(y!=="A")){this._addEventHandler(z,"keypress",s,x,function(B){if(u(B.keyCode)){if(n(z,"click")){h("click",z,B)}else{if(n(z,"dblclick")){h("dblclick",z,B)}}}})}this._addEventHandler(z,"keyup",g,x,function(B){if(u(B.keyCode)){h("mouseup",z,B)}});this._addEventHandler(z,"keydown",c,x,function(B){if(u(B.keyCode)){h("mousedown",z,B)}})};p.prototype.makeAccessibleAllClickEvents=function(){this._visit(this.parser.find("body").firstResult(),function(y){return n(y,"click")||n(y,"mousedown")||n(y,"mouseup")||n(y,"dblclick")},this,this.makeAccessibleClickEvents)};return p})()}).call(this);