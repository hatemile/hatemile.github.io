(function(){var b,a;a=this;this.hatemile||(this.hatemile={});(b=this.hatemile).implementation||(b.implementation={});this.hatemile.implementation.AccessibleAssociationImplementation=(function(){var c;c="data-ignoreaccessibilityfix";d.prototype._getModelTable=function(g){var f,e,k,i,h;h=[];i=this.parser.find(g).findChildren("tr").listResults();for(f=0,e=i.length;f<e;f++){k=i[f];h.push(this._getModelRow(this.parser.find(k).findChildren("th,td").listResults()))}return this._getValidModelTable(h)};d.prototype._getValidModelTable=function(w){var u,q,g,l,i,n,t,p,v,m,f,s,e,o,r,h;f=[];t=w.length;if(t>0){for(r=l=0,e=t-1;0<=e?l<=e:l>=e;r=0<=e?++l:--l){s=w[r];if(f[r]===void 0){f[r]=[]}n=s.length;if(n>0){g=0;for(q=i=0,o=n-1;0<=o?i<=o:i>=o;q=0<=o?++i:--i){u=s[q];p=q+g;v=f[r];while(v[p]!==void 0){g=g+1;p=q+g}v[p]=u;if(u.hasAttribute("rowspan")){h=parseInt(u.getAttribute("rowspan"));m=r;while(h>1){h=h-1;m=m+1;if(f[m]===void 0){f[m]=[]}f[m][p]=u}}}}}}return f};d.prototype._getModelRow=function(e){var m,n,h,g,l,f,k;f=[];l=e.length;if(l>0){f=f.concat(e);m=0;for(h=g=0,k=l-1;0<=k?g<=k:g>=k;h=0<=k?++g:--g){if(e[h].hasAttribute("colspan")){n=parseInt(e[h].getAttribute("colspan"));while(n>1){n=n-1;m=m+1;f.splice(h+m,0,e[h])}}}}return f};d.prototype._validateHeader=function(i){var f,e,g,h;if(i.length===0){return false}g=-1;for(f=0,e=i.length;f<e;f++){h=i[f];if(h.length===0){return false}else{if(g===-1){g=h.length}else{if(h.length!==g){return false}}}}return true};d.prototype._getCellsHeadersIds=function(l,h){var f,i,g,e,k;i=[];for(g=0,e=l.length;g<e;g++){k=l[g];f=k[h];if((f.getTagName()==="TH")&&(f.getAttribute("scope")==="col")){i.push(f.getAttribute("id"))}}return i};d.prototype._associateDataCellsWithHeaderCellsOfRow=function(r){var u,t,e,h,q,o,i,s,p,n,g,f,w,v;v=this._getModelTable(r);for(q=0,s=v.length;q<s;q++){w=v[q];h=[];for(o=0,p=w.length;o<p;o++){u=w[o];if(u.getTagName()==="TH"){this.idGenerator.generateId(u);h.push(u.getAttribute("id"));u.setAttribute("scope","row")}}if(h.length>0){for(i=0,n=w.length;i<n;i++){u=w[i];if(u.getTagName()==="TD"){e=u.getAttribute("headers");for(f=0,g=h.length;f<g;f++){t=h[f];e=a.hatemile.util.CommonFunctions.increaseInList(e,t)}if(e!==null){u.setAttribute("headers",e)}}}}}};d.prototype._prepareHeaderCells=function(g){var f,i,h,e;i=this.parser.find(g).findChildren("tr").findChildren("th").listResults();for(h=0,e=i.length;h<e;h++){f=i[h];this.idGenerator.generateId(f);if(!f.hasAttribute("scope")){f.setAttribute("scope","col")}}};function d(f,e){this.parser=f;this.idGenerator=new hatemile.util.IDGenerator("association")}d.prototype.associateDataCellsWithHeaderCells=function(y){var p,f,e,r,v,A,g,q,o,w,u,t,s,x,n,m,z,h;v=this.parser.find(y).findChildren("thead").firstResult();p=this.parser.find(y).findChildren("tbody").firstResult();r=this.parser.find(y).findChildren("tfoot").firstResult();if(v!==null){this._prepareHeaderCells(v);A=this._getModelTable(v);if((p!==null)&&(this._validateHeader(A))){z=A[0].length;e=this._getModelTable(p);if(r!==null){e=e.concat(this._getModelTable(r))}for(u=0,x=e.length;u<x;u++){h=e[u];if(h.length===z){w=0;for(t=0,n=h.length;t<n;t++){f=h[t];o=this._getCellsHeadersIds(A,w);g=f.getAttribute("headers");for(s=0,m=o.length;s<m;s++){q=o[s];g=a.hatemile.util.CommonFunctions.increaseInList(g,q)}if(g!==null){f.setAttribute("headers",g)}w=w+1}}}}}if(p!==null){this._associateDataCellsWithHeaderCellsOfRow(p)}if(r!==null){this._associateDataCellsWithHeaderCellsOfRow(r)}};d.prototype.associateAllDataCellsWithHeaderCells=function(){var f,e,h,g;g=this.parser.find("table").listResults();for(f=0,e=g.length;f<e;f++){h=g[f];if(a.hatemile.util.CommonFunctions.isValidElement(h)){if(this.parser.find(h).findDescendants(("thead["+c+"],")+("tbody["+c+"],tfoot["+c+"],tr["+c+"],")+("th["+c+"],td["+c+"]")).firstResult()===null){this.associateDataCellsWithHeaderCells(h)}}}};d.prototype.associateLabelWithField=function(e){var f;if(e.getTagName()==="LABEL"){if(e.hasAttribute("for")){f=this.parser.find("#"+(e.getAttribute("for"))).firstResult()}else{f=this.parser.find(e).findDescendants("input,select,textarea").firstResult();if(f!==null){this.idGenerator.generateId(f);e.setAttribute("for",f.getAttribute("id"))}}if((f!==null)&&(!f.hasAttribute(c))){if(!f.hasAttribute("aria-label")){f.setAttribute("aria-label",e.getTextContent().replace(new RegExp("[ \n\t\r]+","g")," "))}this.idGenerator.generateId(e);f.setAttribute("aria-labelledby",a.hatemile.util.CommonFunctions.increaseInList(f.getAttribute("aria-labelledby"),e.getAttribute("id")))}}};d.prototype.associateAllLabelsWithFields=function(){var g,f,h,e;h=this.parser.find("label").listResults();for(g=0,e=h.length;g<e;g++){f=h[g];if(a.hatemile.util.CommonFunctions.isValidElement(f)){this.associateLabelWithField(f)}}};return d})()}).call(this);